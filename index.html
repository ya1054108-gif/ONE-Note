<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>臨床裝置完全筆記 — ECMO · IABP · CVC · A-line · Swan-Ganz · PICC</title>
<meta name="description" content="極為詳細的 ICU / 術中裝置筆記：含解剖示意圖、位置、作用、適應症、禁忌症與併發症。" />
<style>
:root{
  /* 亮色模式變數 */
  --bg: #f4f7fb; 
  --card: #ffffff; 
  --text-main: #0f172a; /* 深色字 */
  --text-muted: #64748b; 
  --accent: #0b6fff; 
  --danger: #e11d48; 
  --ok: #059669;
  --side-w: 250px; 
  --header-h: 64px;
  --border: rgba(0,0,0,0.08);
}

[data-theme="dark"]{
  /* 深色模式變數 */
  --bg: #0f172a; 
  --card: #1e293b; 
  --text-main: #f1f5f9; /* 淺色字 (修正重點) */
  --text-muted: #94a3b8; 
  --accent: #60a5fa; /* 變亮的藍色 */
  --danger: #fb7185; /* 變亮的紅色 */
  --ok: #34d399;
  --border: rgba(255,255,255,0.1);
}

*{box-sizing:border-box}

body{
  font-family: -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
  margin:0; 
  background: var(--bg); 
  color: var(--text-main); /* 讓文字顏色跟隨變數 */
  height:100vh; 
  overflow:hidden;
  transition: background 0.3s, color 0.3s; /* 平滑切換效果 */
}

/* Header */
.header{
  height: var(--header-h); padding: 0 16px;
  display:flex; align-items:center; gap:16px; 
  background: var(--card); border-bottom: 1px solid var(--border);
  position:fixed; top:0; left:0; right:0; z-index:100;
}
.logo{
  width:36px;height:36px;border-radius:8px;
  background:linear-gradient(135deg,var(--accent),#3b82f6);
  display:flex;align-items:center;justify-content:center;
  color:white;font-weight:800;font-size:14px;flex-shrink:0
}
.title-group{display:flex; flex-direction:column;}
.title{font-size:16px; margin:0; font-weight:700; color:var(--text-main)}
.subtitle{color:var(--text-muted); font-size:12px; margin:0;}

.controls{margin-left:auto;display:flex;gap:8px;}
.btn{background:var(--accent);color:white;padding:6px 12px;border-radius:6px;border:none;cursor:pointer;font-weight:600;font-size:13px;}
.btn.ghost{background:transparent;color:var(--accent);border:1px solid var(--border)}
.btn.ghost:hover{background:rgba(11,111,255,0.05)}
.btn.icon-btn{padding:8px; display:flex; align-items:center; justify-content:center; color:var(--text-main)}

/* Layout */
.container{
  display:grid;
  grid-template-columns: var(--side-w) 1fr;
  height: calc(100vh - var(--header-h));
  margin-top: var(--header-h);
  transition: grid-template-columns 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
body.menu-collapsed .container { grid-template-columns: 0px 1fr; }

/* Sidebar */
nav.side{
  background:var(--card); 
  border-right:1px solid var(--border);
  overflow-y:auto; padding:16px;
  width: 100%; transition: opacity 0.2s;
}
body.menu-collapsed nav.side { opacity: 0; pointer-events: none; }

nav.side ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:4px}
nav.side a{
  display:block;padding:8px 12px;border-radius:6px;
  color:var(--text-muted); text-decoration:none;
  font-weight:500; font-size:14px; transition:0.2s
}
nav.side a:hover{background:var(--bg); color:var(--accent)}
nav.side a.active{background:var(--accent); color:#fff; font-weight:600}

/* Main Content */
main{
  padding:24px 40px; 
  background:var(--bg); /* 確保背景色跟隨變數 */
  overflow-y:auto; 
}

.page{display:none; max-width: 900px; margin: 0 auto; padding-bottom: 60px;}
.page.active{display:block; animation: fadeIn 0.4s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* Cards & Sections */
h2{color:var(--text-main); margin-top:0}
.card{
  background:var(--card);
  padding:16px; border-radius:12px;
  border:1px solid var(--border);
  margin-bottom:16px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
.col2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.section-title{
  font-size: 13px; font-weight: 700; 
  color: var(--accent); margin-bottom: 8px;
  text-transform:uppercase; letter-spacing:0.5px;
}
.text{font-size:15px; line-height:1.6; color:var(--text-main)}
ul{padding-left:20px; color:var(--text-main)}

/* Diagram Box (SVG) */
.diagram-box{
  background: var(--card); border-radius: 12px; padding: 10px; 
  display: flex; justify-content: center; align-items: center; margin-bottom: 20px;
  border: 1px dashed var(--border); height: 180px;
  color: var(--text-main); /* 關鍵：讓 SVG 內的 currentColor 讀取這個顏色 */
}
.diagram-box svg{max-height:100%; width:100%;}

/* Inputs & Buttons */
.search{
  width:100%;padding:8px 12px;border-radius:6px;
  border:1px solid var(--border); margin-bottom:16px;
  background:var(--bg); color:var(--text-main);
}
.footerActions{display:flex;gap:8px;margin-top:30px;padding-top:20px;border-top:1px solid var(--border)}

/* Mobile */
@media (max-width: 768px) {
  .subtitle, #exportBtn {display:none}
  .container { display: block; }
  nav.side {
    position: absolute; top: 0; bottom: 0; left: 0; z-index: 50;
    width: 240px; transform: translateX(0); transition: transform 0.3s;
    box-shadow: 4px 0 20px rgba(0,0,0,0.2);
  }
  body.menu-collapsed nav.side { transform: translateX(-100%); opacity: 1; }
  main{padding: 16px;}
  .col2{grid-template-columns:1fr}
}
</style>
</head>
<body class="">

<div class="header">
  <button id="menuToggle" class="btn icon-btn ghost" title="選單">
    <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
  </button>
  <div class="logo">ICU</div>
  <div class="title-group">
    <h1 class="title">臨床裝置筆記</h1>
    <div class="subtitle">ECMO · IABP · CVC · Swan-Ganz · PICC</div>
  </div>
  <div class="controls">
    <button id="toggleTheme" class="btn ghost small">◐</button>
    <button id="printBtn" class="btn ghost small">列印</button>
    <button id="exportBtn" class="btn small">下載</button>
  </div>
</div>

<div class="container">
  <nav class="side">
    <input id="menuFilter" class="search" placeholder="篩選..." />
    <ul id="menuList"></ul>
  </nav>

  <main id="mainContent">
    <!-- Pages go here -->
  </main>
</div>

<script>
// --- SVG Generators (Updated for Dark Mode) ---
// 使用 CSS 變數 (var(--accent), var(--danger)) 讓線條顏色在深色模式下自動變亮
function getDiagram(type) {
  let inner = '';
  const accent = 'var(--accent)';
  const danger = 'var(--danger)';
  const txtColor = 'currentColor'; // 文字顏色自動跟隨父層

  switch(type) {
    case 'ecmo':
      inner = `
        <text x="10" y="20" font-size="10" fill="${txtColor}" opacity="0.7">Venous Drain</text>
        <path d="M30 30 L30 80 Q30 90 50 90 L100 90" stroke="${accent}" stroke-width="4" fill="none"/>
        <rect x="90" y="75" width="40" height="30" rx="4" fill="${accent}" opacity="0.2" stroke="${accent}"/>
        <text x="100" y="93" font-size="8" fill="${txtColor}">Pump</text>
        <path d="M130 90 L170 90 Q190 90 190 80 L190 30" stroke="${danger}" stroke-width="4" fill="none"/>
        <text x="160" y="20" font-size="10" fill="${txtColor}" opacity="0.7">Return</text>
        <path d="M110 50 L115 60 L125 40" stroke="${txtColor}" stroke-width="1" opacity="0.5" fill="none"/>
      `; break;
    case 'iabp':
      inner = `
        <path d="M80 10 Q120 10 120 100" stroke="${danger}" stroke-width="14" opacity="0.15" fill="none"/>
        <rect x="115" y="40" width="10" height="40" rx="5" fill="#f59e0b" opacity="0.9"/>
        <line x1="120" y1="80" x2="120" y2="150" stroke="${txtColor}" stroke-width="2" opacity="0.5"/>
        <text x="135" y="60" font-size="10" fill="#f59e0b" font-weight="bold">Balloon</text>
        <text x="50" y="30" font-size="10" fill="${txtColor}" opacity="0.6">Aorta</text>
      `; break;
    case 'cvc':
    case 'hickman':
    case 'picc':
    case 'porta':
      let label = type.toUpperCase();
      let path = (type==='picc') ? `M10 60 Q60 60 80 40 L100 30` : (type==='porta' ? `M40 50 L60 40 L100 30` : `M60 10 L60 30 L100 30`);
      inner = `
        <path d="M100 10 L100 90" stroke="${accent}" stroke-width="16" opacity="0.15"/>
        <text x="112" y="50" font-size="10" fill="${txtColor}" opacity="0.6">SVC</text>
        <path d="${path}" stroke="#eab308" stroke-width="3" fill="none"/>
        <circle cx="${type==='porta'?40: (type==='picc'?10:60)}" cy="${type==='porta'?50: (type==='picc'?60:10)}" r="4" fill="#eab308"/>
        <text x="10" y="90" font-size="12" fill="${txtColor}" font-weight="bold">${label}</text>
      `; break;
    case 'aline':
      inner = `
        <path d="M10 50 L190 50" stroke="${danger}" stroke-width="12" opacity="0.15"/>
        <path d="M50 20 L70 50" stroke="${accent}" stroke-width="2" fill="none"/>
        <text x="40" y="15" font-size="10" fill="${txtColor}">Cannula</text>
        <path d="M120 30 L130 50 L140 20 L150 60 L160 50 L180 50" stroke="${danger}" stroke-width="2" fill="none"/>
        <text x="120" y="80" font-size="10" fill="${txtColor}">Arterial BP</text>
      `; break;
    case 'swan':
      inner = `
        <path d="M10 50 Q50 20 90 50 T170 50" stroke="${accent}" stroke-width="12" opacity="0.15" fill="none"/>
        <path d="M10 60 Q50 30 90 60 T160 60" stroke="#eab308" stroke-width="3" fill="none" stroke-dasharray="4 2"/>
        <circle cx="160" cy="60" r="5" fill="#eab308" opacity="0.8"/>
        <text x="130" y="85" font-size="10" fill="${txtColor}">Pulmonary A.</text>
      `; break;
    default:
      inner = `<text x="50" y="50" font-size="12" fill="${txtColor}">Device Diagram</text>`;
  }
  return `<svg viewBox="0 0 200 100" fill="none" stroke="currentColor" style="width:100%;height:100%">${inner}</svg>`;
}

// --- Content Data ---
const pages = [
  {
    id: 'ecmo', title: 'ECMO (體外膜氧合)', short: 'Life Support (VA/VV)',
    content: {
      location: '<b>VA</b>：股靜脈(In) → 股動脈(Out)。<br><b>VV</b>：股靜脈(In) → 頸靜脈(Out)。',
      function: '利用離心幫浦與氧合器取代心肺功能。VA支持心肺；VV僅支持肺臟氧合。',
      indication: '心因性休克、ECPR、重度ARDS (PaO₂/FiO₂ < 80)、心肌炎。',
      contraindication: '末期疾病、不可逆腦傷、主動脈剝離(VA禁忌)。',
      complication: '出血(全身肝素化)、下肢缺血(VA)、溶血、感染。',
      care: '監測流量、跨膜壓差(Delta P)、末梢灌流。'
    }
  },
  {
    id: 'iabp', title: 'IABP (主動脈氣球幫浦)', short: 'Counter-pulsation',
    content: {
      location: '股動脈置入，尖端位於左鎖骨下動脈下方2cm。',
      function: '舒張期充氣(增冠狀動脈灌流)，收縮期洩氣(降後負荷)。',
      indication: '心因性休克、AMI併發症、高風險PCI/CABG術前後。',
      contraindication: '主動脈瓣閉鎖不全(AR)、主動脈剝離、嚴重腹主動脈瘤。',
      complication: '下肢缺血(最常見)、氣球破裂、血小板低下。',
      care: '不可彎曲大腿。觀察波形充氣時機。注意足背動脈。'
    }
  },
  {
    id: 'cvc', title: 'CVC (中心靜脈導管)', short: 'Central Line',
    content: {
      location: '內頸靜脈(IJV)、鎖骨下(SCV)、股靜脈。尖端位於SVC。',
      function: '監測CVP、輸注高滲液/昇壓劑、急救輸液。',
      indication: '周邊血管困難、長期給藥、血循不穩。',
      contraindication: '穿刺處感染、嚴重凝血異常。',
      complication: '氣胸(SCV常見)、感染(CLABSI)、心律不整。',
      care: '無菌換藥(Bundle care)。未用管腔需封管。'
    }
  },
  {
    id: 'aline', title: 'A-line (動脈導管)', short: 'BP Monitoring',
    content: {
      location: '橈動脈(首選)、股動脈、足背動脈。',
      function: '連續血壓監測、頻繁抽血(ABG)。',
      indication: '休克使用昇壓劑、呼吸衰竭需頻繁驗血。',
      contraindication: 'Allen\'s Test異常、局部感染。',
      complication: '血栓導致肢體缺血、出血、感染。',
      care: '加壓袋300mmHg。歸零點：第4肋間腋中線。'
    }
  },
  {
    id: 'swan', title: 'Swan-Ganz (肺動脈導管)', short: 'Hemodynamics',
    content: {
      location: '經大靜脈 → RA → RV → PA → 嵌塞肺小動脈。',
      function: '測PCWP(左心前負荷)、CO、SVR。',
      indication: '不明原因休克、複雜心臟術後。',
      contraindication: '右心血栓、三尖瓣機械瓣膜。',
      complication: '肺動脈破裂(致死)、心律不整、導管打結。',
      care: '氣球不可長時間充氣(防肺梗塞)。'
    }
  },
  {
    id: 'double', title: 'Double-lumen', short: 'Hemodialysis',
    content: {
      location: '短期：IJV/Femoral。長期：隧道式(Perm-Cath)。',
      function: '高流速通路，專供血液透析(HD)使用。',
      indication: '急慢性腎衰竭需透析。',
      contraindication: '同CVC。SVC症候群。',
      complication: '導管阻塞、感染風險極高。',
      care: '嚴禁一般輸液(除非急救)。使用高濃度肝素封管。'
    }
  },
  {
    id: 'picc', title: 'PICC (周邊中心導管)', short: 'Peripherally Inserted',
    content: {
      location: '上臂貴要靜脈 → SVC。',
      function: '中長期(週~月)輸液，無氣胸風險。',
      indication: '抗生素>1週、TPN、周邊血管差。',
      contraindication: '洗腎廔管同側、乳癌淋巴廓清側。',
      complication: '靜脈炎、導管移位、DVT。',
      care: '禁量血壓/抽血(該側)。每日量臂圍。'
    }
  },
  {
    id: 'porta', title: 'Port-A (人工血管)', short: 'Implantable Port',
    content: {
      location: '前胸皮下埋入基座，導管至SVC。',
      function: '長期(年)、間歇性化療使用。',
      indication: '癌症長期化療。',
      contraindication: '感染、凝血異常。',
      complication: '導管斷裂、注射座翻轉、藥物外滲。',
      care: '須用Huber針(無削切)。用畢Heparin lock。'
    }
  }
];

// --- App Logic ---
const menu = document.getElementById('menuList');
const main = document.getElementById('mainContent');
const toggleBtn = document.getElementById('menuToggle');
const isMobile = () => window.innerWidth < 768;

// Toggle Menu
toggleBtn.addEventListener('click', () => {
  document.body.classList.toggle('menu-collapsed');
});

// Build Pages
pages.forEach((p, idx)=>{
  // Menu Item
  const li = document.createElement('li');
  li.innerHTML = `<a href="#${p.id}" data-id="${p.id}">${p.title}</a>`;
  menu.appendChild(li);

  // Content
  const prev = idx > 0 ? pages[idx-1].id : null;
  const next = idx < pages.length-1 ? pages[idx+1].id : null;
  
  const article = document.createElement('article');
  article.className = 'page';
  article.id = 'page-'+p.id;
  article.innerHTML = `
    <h2 style="font-size:24px;margin-bottom:4px">${p.title}</h2>
    <div style="color:var(--text-muted);margin-bottom:20px;font-weight:500;font-size:14px">${p.short}</div>

    <div class="diagram-box">
      ${getDiagram(p.id)}
    </div>

    <div class="col2">
      <div class="card">
        <div class="section-title">位置 (Location)</div>
        <div class="text">${p.content.location}</div>
      </div>
      <div class="card">
        <div class="section-title">作用 (Function)</div>
        <div class="text">${p.content.function}</div>
      </div>
    </div>

    <div class="card" style="border-left:4px solid var(--ok)">
      <div class="section-title" style="color:var(--ok)">適應症 (Indications)</div>
      <div class="text">${p.content.indication}</div>
    </div>

    <div class="col2">
      <div class="card" style="border-left:4px solid var(--danger)">
        <div class="section-title" style="color:var(--danger)">禁忌症 (Contraindications)</div>
        <div class="text">${p.content.contraindication}</div>
      </div>
      <div class="card" style="border-left:4px solid var(--danger)">
        <div class="section-title" style="color:var(--danger)">併發症 (Complications)</div>
        <div class="text">${p.content.complication}</div>
      </div>
    </div>

    <div class="card">
      <div class="section-title" style="color:var(--text-muted)">護理重點 (Care)</div>
      <div class="text">${p.content.care}</div>
    </div>

    <div class="footerActions">
      <button class="btn ghost small" data-prev="${prev}" ${prev?'':'disabled'}>← 上一個</button>
      <div style="margin-left:auto">
        <button class="btn small" data-next="${next}" ${next?'':'disabled'}>下一個 →</button>
      </div>
    </div>
  `;
  main.appendChild(article);
});

// Navigation
const showPage = (id) => {
  document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('#menuList a').forEach(el => el.classList.remove('active'));
  
  const target = document.getElementById('page-'+id);
  if(target) { target.classList.add('active'); main.scrollTop = 0; }
  
  const link = document.querySelector(`#menuList a[data-id="${id}"]`);
  if(link) link.classList.add('active');
  
  if(isMobile()) document.body.classList.add('menu-collapsed');
};

document.body.addEventListener('click', (e) => {
  if(e.target.matches('#menuList a')) {
    e.preventDefault();
    showPage(e.target.dataset.id);
  }
  if(e.target.matches('[data-next]')) showPage(e.target.dataset.next);
  if(e.target.matches('[data-prev]')) showPage(e.target.dataset.prev);
});

// Init
if(isMobile()) document.body.classList.add('menu-collapsed');
const hash = location.hash.replace('#','');
showPage(hash || pages[0].id);

// Utils
document.getElementById('toggleTheme').addEventListener('click', ()=>{
  const html = document.documentElement;
  html.setAttribute('data-theme', html.hasAttribute('data-theme') ? '' : 'dark');
});
document.getElementById('menuFilter').addEventListener('input', (e)=>{
  const term = e.target.value.toLowerCase();
  document.querySelectorAll('#menuList li').forEach(li => {
    li.style.display = li.innerText.toLowerCase().includes(term) ? '' : 'none';
  });
});
document.addEventListener('keydown', (e)=>{
  const active = document.querySelector('.page.active');
  if(!active) return;
  const idx = pages.findIndex(p => p.id === active.id.replace('page-',''));
  if(e.key === 'ArrowRight' && idx < pages.length-1) showPage(pages[idx+1].id);
  if(e.key === 'ArrowLeft' && idx > 0) showPage(pages[idx-1].id);
});
</script>
</body>
</html>
