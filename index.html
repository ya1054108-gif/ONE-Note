<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>ICU è‡¨åºŠè£ç½®é€ŸæŸ¥æ‰‹å†Š (Taiwan Edition)</title>
<meta name="description" content="å°ç£è‡¨åºŠå°ˆç”¨ï¼šECMO, IABP, CVC, PICC ç­‰è£ç½®è­·ç†é‡é»èˆ‡åƒæ•¸è¨­å®šã€‚" />
<style>
:root{
  /* äº®è‰²æ¨¡å¼ Theme */
  --bg: #f8fafc; 
  --card-bg: #ffffff; 
  --text-main: #1e293b; 
  --text-muted: #64748b; 
  --accent: #0284c7; /* é†«å¸«è¢è— */
  --accent-light: #e0f2fe;
  --danger: #e11d48; 
  --warning: #d97706;
  --ok: #059669;
  --border: #e2e8f0;
  --header-h: 60px;
  --sidebar-w: 260px;
  --radius: 12px;
}

[data-theme="dark"]{
  /* æ·±è‰²æ¨¡å¼ Theme */
  --bg: #0f172a; 
  --card-bg: #1e293b; 
  --text-main: #f1f5f9; 
  --text-muted: #94a3b8; 
  --accent: #38bdf8; 
  --accent-light: rgba(56, 189, 248, 0.1);
  --danger: #fb7185; 
  --warning: #fbbf24;
  --ok: #34d399;
  --border: #334155;
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}

body{
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", Helvetica, Arial, sans-serif; 
  margin:0; background: var(--bg); color: var(--text-main); 
  height:100vh; overflow:hidden;
  transition: background 0.3s ease;
}

/* --- Header --- */
.header{
  height: var(--header-h); padding: 0 16px;
  display:flex; align-items:center; gap:12px; 
  background: var(--card-bg); border-bottom: 1px solid var(--border);
  position:fixed; top:0; left:0; right:0; z-index:100;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}
.logo-area{display:flex;align-items:center;gap:10px;cursor:pointer}
.logo-icon{
  width:32px;height:32px;border-radius:8px;
  background:linear-gradient(135deg,var(--accent),#2563eb);
  color:white;display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:12px;
}
.app-title{font-size:16px; font-weight:700; color:var(--text-main); line-height:1.2}
.app-subtitle{font-size:11px; color:var(--text-muted); font-weight:400}
.header-actions{margin-left:auto; display:flex; gap:8px}

.btn{
  background:var(--accent); color:white; padding:6px 12px; 
  border-radius:6px; border:none; cursor:pointer; font-weight:600; font-size:13px;
  display:inline-flex; align-items:center; justify-content:center; gap:4px;
  transition: all 0.2s active;
}
.btn:active{transform:scale(0.96)}
.btn.ghost{background:transparent; color:var(--text-main); border:1px solid var(--border)}
.btn.ghost:hover{background:var(--accent-light); color:var(--accent); border-color:var(--accent)}
.icon-btn{padding:8px; background:transparent; color:var(--text-main); border:none; cursor:pointer; border-radius:50%}
.icon-btn:hover{background:var(--accent-light); color:var(--accent)}

/* --- Layout --- */
.main-container{
  margin-top: var(--header-h);
  height: calc(100vh - var(--header-h));
  position: relative;
  overflow: hidden;
}

/* --- Sidebar (Navigation) --- */
.sidebar-overlay{
  position:fixed; top:0; left:0; right:0; bottom:0; z-index:140;
  background:rgba(0,0,0,0.5); display:none; opacity:0; transition:opacity 0.3s;
}
.sidebar-overlay.open{display:block; opacity:1}

.sidebar{
  position:fixed; top:0; bottom:0; left:0; z-index:150;
  width: var(--sidebar-w); background: var(--card-bg);
  border-right: 1px solid var(--border);
  transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
  display:flex; flex-direction:column;
  box-shadow: 4px 0 24px rgba(0,0,0,0.1);
}
.sidebar.open{transform: translateX(0)}

.sidebar-header{height:var(--header-h); border-bottom:1px solid var(--border); display:flex; align-items:center; padding:0 16px; justify-content:space-between}
.sidebar-scroll{overflow-y:auto; flex:1; padding:16px}
.nav-item{
  display:block; padding:10px 12px; border-radius:8px;
  color:var(--text-muted); text-decoration:none; font-weight:500; font-size:15px;
  margin-bottom:4px; transition:0.2s;
}
.nav-item:hover{background:var(--bg); color:var(--text-main)}
.nav-item.active{background:var(--accent-light); color:var(--accent); font-weight:600}

/* --- Content Views --- */
#view-container{
  height: 100%; overflow-y: auto; padding: 20px;
  scroll-behavior: smooth;
}

/* 1. Home Grid View */
.home-grid{
  display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:16px;
  max-width:1000px; margin:0 auto;
  animation: fadeUp 0.4s ease;
}
.device-card{
  background: var(--card-bg); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 20px;
  cursor: pointer; position: relative; overflow: hidden;
  transition: all 0.2s; display:flex; flex-direction:column;
}
.device-card:hover{
  transform: translateY(-4px); 
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
  border-color: var(--accent);
}
.card-icon-wrap{
  width: 50px; height: 50px; background: var(--accent-light); 
  border-radius: 10px; color: var(--accent);
  display: flex; align-items: center; justify-content: center;
  margin-bottom: 12px;
}
.card-title{font-size:18px; font-weight:700; margin:0 0 6px 0; color:var(--text-main)}
.card-desc{font-size:13px; color:var(--text-muted); line-height:1.5; flex-grow:1}
.card-arrow{margin-top:16px; font-size:13px; font-weight:600; color:var(--accent); display:flex; align-items:center; gap:4px}

/* 2. Detail Page View */
.detail-page{
  display:none; max-width: 800px; margin: 0 auto; padding-bottom: 60px;
  animation: fadeIn 0.3s ease;
}
.detail-page.active{display:block}

.detail-header{margin-bottom:24px; display:flex; flex-direction:column; gap:8px}
.detail-title{font-size:26px; font-weight:800; margin:0; color:var(--text-main)}
.detail-subtitle{font-size:14px; color:var(--accent); background:var(--accent-light); display:inline-block; padding:4px 8px; border-radius:6px; font-weight:600; align-self:flex-start}

.diagram-container{
  background: var(--card-bg); border: 1px dashed var(--border); 
  border-radius: var(--radius); padding: 20px; height: 180px;
  display:flex; justify-content:center; margin-bottom: 24px;
}
.diagram-container svg{width:100%; height:100%; color:var(--text-main)}

/* Content Blocks */
.info-block{
  background: var(--card-bg); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 20px; margin-bottom: 16px;
}
.block-title{
  font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;
  font-weight: 700; color: var(--text-muted); margin-bottom: 10px;
  display: flex; align-items: center; gap: 8px;
}
.block-title.red{color:var(--danger)}
.block-title.green{color:var(--ok)}
.block-content{font-size: 15px; line-height: 1.7; color: var(--text-main);}

/* List Styles */
ul{margin:0; padding-left:20px}
li{margin-bottom:6px}
b{color:var(--text-main); font-weight:700}

/* Utility */
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.hidden{display:none}

/* Mobile Responsive */
@media (max-width: 600px){
  .header{padding:0 12px}
  .app-title{font-size:15px}
  .app-subtitle{display:none} /* æ‰‹æ©Ÿä¸é¡¯ç¤ºå‰¯æ¨™é¡Œ */
  .home-grid{grid-template-columns: 1fr}
  #view-container{padding:16px}
  .detail-title{font-size:22px}
}
</style>
</head>
<body>

<!-- Header -->
<header class="header">
  <button class="icon-btn" id="menuBtn">
    <svg width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
  </button>
  
  <div class="logo-area" onclick="goHome()">
    <div class="logo-icon">ICU</div>
    <div>
      <div class="app-title">è‡¨åºŠè£ç½®é€ŸæŸ¥</div>
      <div class="app-subtitle">Taiwan Clinical Guide</div>
    </div>
  </div>

  <div class="header-actions">
    <button class="icon-btn" id="themeBtn" title="åˆ‡æ›æ·±è‰²/äº®è‰²">
      <svg width="20" height="20" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
    </button>
  </div>
</header>

<!-- Sidebar -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>
<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <span style="font-weight:700;color:var(--text-main)">è£ç½®ç›®éŒ„</span>
    <button class="icon-btn" id="closeSidebar">âœ•</button>
  </div>
  <div class="sidebar-scroll" id="sidebarList">
    <!-- Items Injected Here -->
  </div>
  <div style="padding:16px; border-top:1px solid var(--border); font-size:12px; color:var(--text-muted)">
    Ver 2025.12<br>Designed for Taiwan ICU
  </div>
</aside>

<!-- Main Area -->
<div class="main-container">
  <div id="view-container">
    <!-- Views will be injected here: Either Home Grid or Detail Page -->
  </div>
</div>

<script>
// --- Data: å°ç£è‡¨åºŠå£èªåŒ–å…§å®¹ ---
const devices = [
  {
    id: 'ecmo', 
    title: 'ECMO è‘‰å…‹è†œ', 
    short: 'Extracorporeal Membrane Oxygenation',
    icon: '<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>', // Heartbeat
    content: {
      intro: 'ä¿—ç¨±ã€Œè‘‰å…‹è†œã€ã€‚ç°¡å–®èªªå°±æ˜¯äººå·¥å¿ƒè‚ºæ©Ÿã€‚åˆ†ç‚º VA (æ•‘å¿ƒ+è‚º) èˆ‡ VV (åªæ•‘è‚º) å…©ç¨®æ¨¡å¼ã€‚ä¸»è¦é é›¢å¿ƒå¹«æµ¦ (Pump) èˆ‡æ°§åˆå™¨ (Artificial Lung) é‹ä½œã€‚',
      location: '<b>VA mode</b>ï¼šé€šå¸¸ç”±è‚¡éœè„ˆ (In) å¼•æµï¼Œç¶“è‚¡å‹•è„ˆ (Out) æ‰“å›èº«é«” (Retrograde flow)ã€‚<br><b>VV mode</b>ï¼šè‚¡éœè„ˆ (In) å¼•æµï¼Œé ¸éœè„ˆ (Out) æ‰“å›ï¼Œæˆ–ä½¿ç”¨ Avalon é›™è…”å°ç®¡ã€‚',
      indication: '<ul><li><b>VA</b>ï¼šåš´é‡å¿ƒå› æ€§ä¼‘å…‹ (Cardiogenic shock)ã€IHCA/OHCA æ‹š ECPRã€å¿ƒè‚Œç‚ã€ç„¡æ³•è„«é›¢é«”å¤–å¾ªç’° (Weaning failure)ã€‚</li><li><b>VV</b>ï¼šé‡åº¦ ARDS (PaOâ‚‚/FiOâ‚‚ < 80)ã€åš´é‡ COâ‚‚ retentionã€Lung restã€‚</li></ul>',
      tips: '<ul><li><b>Flow æµé‡</b>ï¼šæˆäººé€šå¸¸ç¶­æŒ 3-5 L/minã€‚</li><li><b>åŒ—æ¥µç†Š (Heater)</b>ï¼šæ³¨æ„æ°´æº«è¨­å®šï¼Œé¿å… Hypothermiaã€‚</li><li><b>æœ«æ¢¢å¾ªç’°</b>ï¼šVA mode å‹™å¿…ç›£æ¸¬æ’ç®¡å´ä¸‹è‚¢æ˜¯å¦æœ‰ç¼ºè¡€ (DPC æœ‰ç„¡é€šæš¢)ï¼Œå°å¿ƒè…”å®¤ç—‡å€™ç¾¤ã€‚</li><li><b>æŠ—å‡è¡€</b>ï¼šHeparin keep ACT 160-200s (ä¾å„é™¢ Protocol)ã€‚</li></ul>'
    }
  },
  {
    id: 'iabp', 
    title: 'IABP ä¸»å‹•è„ˆæ°£çƒ', 
    short: 'Intra-Aortic Balloon Pump',
    icon: '<circle cx="12" cy="12" r="10"/><path d="M8 12h8"/>', // Balloon
    content: {
      intro: 'å¿ƒè‡Ÿç§‘çš„ã€Œé¦¬é”è¼”åŠ©å™¨ã€ã€‚åˆ©ç”¨æ°£çƒåœ¨èˆ’å¼µæœŸå……æ°£ã€æ”¶ç¸®æœŸæ´©æ°£ (Counter-pulsation) ä¾†æ¸›è¼•å·¦å¿ƒå®¤è² æ“”ä¸¦å¢åŠ å† ç‹€å‹•è„ˆè¡€æµã€‚',
      location: 'ç”±è‚¡å‹•è„ˆ (Femoral A.) æ‰“å…¥ã€‚Tip æ‡‰ä½æ–¼<b>å·¦é–éª¨ä¸‹å‹•è„ˆ (L. Subclavian A.) é–‹å£ä¸‹æ–¹ 2cm</b> (ç´„ T2-T3)ã€‚CXR ä¸Šè¦çœ‹åˆ°æ¨™è¨˜é»ã€‚',
      indication: '<ul><li>AMI ä½µç™¼å¿ƒå› æ€§ä¼‘å…‹ã€‚</li><li>äºŒå°–ç“£é€†æµ (MR) æˆ– VSD é€ æˆçš„è¡€å¾ªä¸ç©©ã€‚</li><li>é«˜é¢¨éšª PCI æˆ– CABG è¡“å‰/è¡“å¾Œ Supportã€‚</li></ul>',
      tips: '<ul><li><b>Timing</b>ï¼šæœ€é‡è¦ï¼å……æ°£é»åœ¨ Dicrotic notch (ä¸»å‹•è„ˆç“£é—œé–‰æ™‚)ã€‚</li><li><b>Nursing</b>ï¼šæ’ç®¡å´å¤§è…¿<b>çµ•å°ä¸å¯å½æ›²</b> (Keep straight)ï¼ŒåºŠé ­æŠ¬é«˜ < 30åº¦ã€‚</li><li><b>è§€å¯Ÿ</b>ï¼šå·¦æ‰‹æ©ˆå‹•è„ˆè„ˆæ (æ°£çƒå¤ªé«˜æœƒæ“‹åˆ°)ã€å°¿é‡ (æ°£çƒå¤ªä½æ“‹åˆ°è…å‹•è„ˆ)ã€‚</li><li><b>Weaning</b>ï¼šå¾ 1:1 æ”¹ç‚º 1:2 -> 1:3 è§€å¯Ÿè¡€å£“ã€‚</li></ul>'
    }
  },
  {
    id: 'cvc', 
    title: 'CVC ä¸­å¿ƒéœè„ˆå°ç®¡', 
    short: 'Central Venous Catheter',
    icon: '<path d="M5 12h14M12 5v14"/>', // Cross
    content: {
      intro: 'ä¿—ç¨±ã€ŒCentral lineã€ã€‚æ€¥æ•‘ã€å¤§é‡è¼¸æ¶²ã€å‡å£“åŠ‘ (Inotropes) å¿…å‚™é€šè·¯ã€‚ç”±å¤§éœè„ˆç›´é€šå³å¿ƒæˆ¿å…¥å£ã€‚',
      location: 'å¸¸è¦‹ä¸‰è™•ï¼š<b>IJV (å…§é ¸)</b>ã€<b>Subclavian (é–éª¨ä¸‹)</b>ã€<b>Femoral (è‚¡)</b>ã€‚Tip æ‡‰ä½æ–¼ SVC èˆ‡ RA äº¤ç•Œè™• (Cavo-atrial junction)ã€‚',
      indication: '<ul><li>å‘¨é‚Šè¡€ç®¡æ‰“ä¸åˆ° (Difficult IV access)ã€‚</li><li>éœ€çµ¦äºˆå‡å£“åŠ‘ (Levophed)ã€é«˜æ¿ƒåº¦é‰€é›¢å­ã€TPNã€‚</li><li>ç›£æ¸¬ CVP (é›–ç„¶ç¾åœ¨æ¯”è¼ƒå°‘å–®çœ‹ CVP)ã€‚</li></ul>',
      tips: '<ul><li><b>CXR ç¢ºèª</b>ï¼šOn å®Œä¸€å®šè¦ç…§ CXR ç¢ºèªä½ç½®ä¸¦æ’é™¤æ°£èƒ¸ (Pneumothorax)ã€‚</li><li><b>ç…§è­·</b>ï¼šè½å¯¦ Bundle Careï¼Œæ›è—¥éœ€ç„¡èŒã€‚</li><li><b>Femoral site</b>ï¼šé›–ç„¶å¥½æ‰“ä½†æ„ŸæŸ“ç‡æœ€é«˜ï¼Œä¸”å½±éŸ¿ç—…äººä¸‹åºŠï¼Œéå¿…è¦ç›¡å¿«ç§»é™¤ã€‚</li><li><b>Air Embolism</b>ï¼šç§»é™¤æ™‚è«‹ç—…äººé–‰æ°£ (Valsalva)ï¼Œæ‹”å‡ºå¾Œæ²¹ç´—å¸ƒåŠ å£“ã€‚</li></ul>'
    }
  },
  {
    id: 'aline', 
    title: 'A-line å‹•è„ˆå°ç®¡', 
    short: 'Arterial Line',
    icon: '<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>', // Waveform
    content: {
      intro: 'é‡ç—‡ç—…äººå¿…å‚™çš„ã€Œå³æ™‚è¡€å£“è¨ˆã€ã€‚é™¤äº†çœ‹ Beat-to-beat è¡€å£“ï¼Œæœ€å¤§å¥½è™•æ˜¯å¯ä»¥éš¨æ™‚æŠ½ ABG ä¸ç”¨ä¸€ç›´æ‰é‡ã€‚',
      location: 'é¦–é¸<b>æ©ˆå‹•è„ˆ (Radial)</b>ï¼Œæ‰“ä¹‹å‰åš Allen\'s Testã€‚æ¬¡é¸è‚¡å‹•è„ˆ (Femoral) æˆ–è¶³èƒŒå‹•è„ˆ (Dorsalis pedis)ã€‚',
      indication: '<ul><li>è¡€æµå‹•åŠ›å­¸ä¸ç©© (Hemodynamic instability)ã€‚</li><li>ä½¿ç”¨å¼·æ•ˆ Vasopressor éœ€ç²¾æº–ç›£æ¸¬ BPã€‚</li><li>å‘¼å¸è¡°ç«­éœ€é »ç¹è¿½è¹¤ ABGã€‚</li></ul>',
      tips: '<ul><li><b>æ­¸é›¶ (Zeroing)</b>ï¼šTransducer å°é½Šç¬¬ 4 è‚‹é–“è…‹ä¸­ç·š (Phlebostatic axis)ã€‚</li><li><b>åŠ å£“è¢‹</b>ï¼šKeep 300 mmHgï¼Œæ¯å°æ™‚ flush ä¿æŒé€šæš¢ã€‚</li><li><b>Damping</b>ï¼šæ³¢å½¢è®Šéˆæª¢æŸ¥æ˜¯å¦æœ‰æ°£æ³¡ã€æŠ˜åˆ°æˆ–è²¼ç‰†ã€‚</li><li><b>åš´ç¦çµ¦è—¥</b>ï¼šçµ•å°ä¸èƒ½å¾ A-line çµ¦è—¥ï¼Œæœƒé€ æˆè‚¢é«”å£æ­»ï¼</li></ul>'
    }
  },
  {
    id: 'picc', 
    title: 'PICC äººå·¥è¡€ç®¡', 
    short: 'Peripherally Inserted Central Catheter',
    icon: '<rect x="2" y="6" width="20" height="12" rx="2"/>', // Tube
    content: {
      intro: 'å¾æ‰‹è‡‚æ‰“é€²å»çš„ä¸­å¿ƒéœè„ˆå°ç®¡ã€‚æ¯”èµ· CVCï¼Œå®ƒæ²’æœ‰æ°£èƒ¸é¢¨éšªï¼Œå¯ä»¥ç•™ç½®æ•¸é€±åˆ°æ•¸å€‹æœˆï¼Œé©åˆé•·æœŸæŠ—ç”Ÿç´ æˆ–åŒ–ç™‚ã€‚',
      location: 'ä¸Šè‡‚è²´è¦éœè„ˆ (Basilic) æœ€ç›´æœ€å¥½æ‰“ã€‚Tip ä¸€æ¨£ä½æ–¼ SVCã€‚',
      indication: '<ul><li>éœ€é•·æœŸæ‰“æŠ—ç”Ÿç´  (> 14å¤©)ã€‚</li><li>æ–½æ‰“ TPN æˆ–åŒ–ç™‚è—¥ç‰©ã€‚</li><li>å‘¨é‚Šè¡€ç®¡æ¥µå·® (Poor vessel condition)ã€‚</li></ul>',
      tips: '<ul><li><b>ç¦å¿Œ</b>ï¼šé è¨ˆåšæ´—è…å»”ç®¡ (AV fistula) çš„æ‰‹ã€ä¹³ç™Œæ·‹å·´å»“æ¸…å´ï¼Œ<b>ä¸èƒ½æ‰“ PICC</b>ã€‚</li><li><b>é‡è¡€å£“</b>ï¼šPICC é‚£éš»æ‰‹<b>ç¦æ­¢é‡è¡€å£“</b>æˆ–æŠ½è¡€ã€‚</li><li><b>è‡‚åœ</b>ï¼šæ¯å¤©æ¸¬é‡ä¸Šè‡‚åœï¼Œè‹¥è…«è„¹è¦æ‡·ç–‘ DVTã€‚</li></ul>'
    }
  },
  {
    id: 'swan', 
    title: 'Swan-Ganz', 
    short: 'Pulmonary Artery Catheter',
    icon: '<path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>', // Layers
    content: {
      intro: 'å¿ƒè‡Ÿç§‘çš„ç¥å™¨ï¼Œåˆç¨± PACã€‚ç›´æ¥ä¼¸é€²è‚ºå‹•è„ˆæ¸¬é‡å£“åŠ›ï¼Œç”¨ä¾†é‘‘åˆ¥ä¼‘å…‹åŸå›  (å¿ƒå› æ€§ vs åˆ†å¸ƒæ€§) èˆ‡æ¸¬é‡ Cardiac Outputã€‚',
      location: 'ç¶“ç”± Sheath æ”¾å…¥ï¼Œä¸€è·¯é£„ï¼šRA -> RV -> PA -> PCWP (Wedge)ã€‚',
      indication: '<ul><li>è¤‡é›œçš„å¿ƒè‡Ÿæ‰‹è¡“è¡“å¾Œ (Post-CABG/Valve)ã€‚</li><li>ä¸æ˜åŸå› çš„ä¼‘å…‹æˆ–è‚ºæ°´è…«ã€‚</li><li>è‚ºé«˜å£“ (Pulmonary Hypertension) è©•ä¼°ã€‚</li></ul>',
      tips: '<ul><li><b>PCWP</b>ï¼šæ°£çƒå……æ°£æ¸¬ Wedge pressure ä»£è¡¨å·¦å¿ƒå‰è² è·ã€‚<b>æ¸¬å®Œé¦¬ä¸Šæ”¾æ°£</b>ï¼Œä¸ç„¶æœƒè‚ºæ¢—å¡ (PA Infarction)ã€‚</li><li><b>æ³¢å½¢</b>ï¼šè­·ç†å¸«éœ€ç†Ÿæ‚‰å„è…”å®¤æ³¢å½¢ï¼Œè‹¥å°ç®¡æ»‘å‹• (Migration) éœ€é€šçŸ¥é†«å¸«ã€‚</li><li><b>æ•¸å€¼</b>ï¼šCI æ­£å¸¸ 2.5-4.0ï¼›SVR ä»£è¡¨è¡€ç®¡é˜»åŠ›ã€‚</li></ul>'
    }
  },
  {
    id: 'double', 
    title: 'Double Lumen æ´—è…å°ç®¡', 
    short: 'Hemodialysis Catheter',
    icon: '<circle cx="12" cy="12" r="10"/><path d="M12 6v12M6 12h12"/>', 
    content: {
      intro: 'é›™è…”å°ç®¡ï¼Œç´…é ­(A)å‡ºã€è—é ­(V)å…¥ã€‚å°ˆé–€ç‚ºäº†æ´—è… (HD) æˆ–æ´—è‚ (MARS) è¨­è¨ˆçš„å¤§æµé‡ç®¡è·¯ã€‚',
      location: 'çŸ­æœŸæ’ IJV æˆ– Femoralã€‚é•·æœŸå‰‡åš Perm-cath (æœ‰çš®ä¸‹éš§é“)ã€‚',
      indication: 'æ€¥æ€§è…è¡°ç«­éœ€ç·Šæ€¥é€æã€AVå»”ç®¡é‚„æ²’æˆç†Ÿæ™‚ã€‚',
      tips: '<ul><li><b>å°ˆç®¡å°ˆç”¨</b>ï¼šé™¤éæ€¥æ•‘å¿«æ­»æ‰äº†ï¼Œå¦å‰‡<b>åš´ç¦</b>æ‹¿æ´—è…å°ç®¡ä¾†è¼¸è¡€æˆ–çµ¦è—¥ã€‚</li><li><b>å°ç®¡</b>ï¼šæ´—å®Œè…æœƒç”¨é«˜æ¿ƒåº¦ Heparin å°ç®¡ï¼Œä¸‹æ¬¡ä½¿ç”¨å‰å‹™å¿…æŠ½å‡ºï¼Œä¸ç„¶æ‰“é€²å»ç—…äººæœƒå‡ºè¡€ (Systemic Heparinization)ã€‚</li></ul>'
    }
  }
];

// --- Logic ---

const viewContainer = document.getElementById('view-container');
const sidebar = document.getElementById('sidebar');
const sidebarOverlay = document.getElementById('sidebarOverlay');
const sidebarList = document.getElementById('sidebarList');

// 1. Render Sidebar
function renderSidebar(){
  let html = `<a href="#" class="nav-item" onclick="goHome(); return false;">ğŸ  å›é¦–é  (Dashboard)</a>`;
  devices.forEach(d => {
    html += `<a href="#${d.id}" class="nav-item" data-id="${d.id}" onclick="route('${d.id}'); return false;">${d.title}</a>`;
  });
  sidebarList.innerHTML = html;
}

// 2. Render Home Grid
function renderHome(){
  let html = `<div class="home-grid">`;
  devices.forEach(d => {
    html += `
      <div class="device-card" onclick="route('${d.id}')">
        <div class="card-icon-wrap">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">${d.icon}</svg>
        </div>
        <h3 class="card-title">${d.title}</h3>
        <div class="card-desc">${d.content.intro}</div>
        <div class="card-arrow">æŸ¥çœ‹è©³æƒ… â†’</div>
      </div>
    `;
  });
  html += `</div>`;
  viewContainer.innerHTML = html;
  updateActiveNav(null);
}

// 3. Render Detail Page
function renderDetail(id){
  const device = devices.find(d => d.id === id);
  if(!device) return renderHome();

  // SVG Diagram logic (Reused but simplified)
  const svgContent = getDiagramSVG(id);

  const html = `
    <div class="detail-page active">
      <div style="margin-bottom:20px">
        <button class="btn ghost small" onclick="goHome()">â† å›åˆ—è¡¨</button>
      </div>

      <div class="detail-header">
        <span class="detail-subtitle">${device.short}</span>
        <h1 class="detail-title">${device.title}</h1>
      </div>

      <div class="diagram-container">
        ${svgContent}
      </div>

      <div class="info-block">
        <div class="block-title">ğŸ“ ä½ç½®èˆ‡åŸç† (Location & Mechanism)</div>
        <div class="block-content">${device.content.location}</div>
      </div>

      <div class="info-block">
        <div class="block-title green">âœ” é©æ‡‰ç—‡ (Indication)</div>
        <div class="block-content">${device.content.indication}</div>
      </div>

      <div class="info-block">
        <div class="block-title red">âš  è‡¨åºŠç…§è­·é‡é» (Clinical Tips)</div>
        <div class="block-content">${device.content.tips}</div>
      </div>
      
      <div style="margin-top:40px; text-align:center; opacity:0.6; font-size:13px">
        - End of Note -
      </div>
    </div>
  `;
  viewContainer.innerHTML = html;
  viewContainer.scrollTop = 0;
  updateActiveNav(id);
}

// SVG Generator
function getDiagramSVG(type){
  const accent = 'var(--accent)';
  const danger = 'var(--danger)';
  const txt = 'currentColor';
  let inner = '';
  
  // ç°¡æ˜“ç¤ºæ„åœ–é‚è¼¯
  if(type === 'ecmo'){
    inner = `<path d="M40 80 Q60 80 60 40 L100 20" stroke="${accent}" stroke-width="4" fill="none" marker-end="url(#arrow)"/><rect x="80" y="60" width="40" height="30" rx="4" stroke="${accent}" fill="none" opacity="0.5"/><text x="90" y="80" font-size="10" fill="${txt}">Pump</text><path d="M130 75 L160 75 Q180 75 180 50 L180 20" stroke="${danger}" stroke-width="4" fill="none"/>`;
  } else if (type === 'iabp'){
    inner = `<path d="M100 10 L100 150" stroke="${danger}" stroke-width="14" opacity="0.2"/><rect x="95" y="50" width="10" height="40" rx="5" fill="#f59e0b"/><text x="120" y="75" font-size="12" fill="${txt}">Balloon (Ao)</text>`;
  } else if (['cvc','picc','hickman','double'].includes(type)){
    inner = `<path d="M100 10 L100 100" stroke="${accent}" stroke-width="16" opacity="0.2"/><text x="115" y="50" font-size="10" fill="${txt}">SVC</text><path d="M50 20 L80 40 L100 40" stroke="#eab308" stroke-width="3" fill="none"/><circle cx="50" cy="20" r="4" fill="#eab308"/>`;
  } else if (type === 'aline'){
    inner = `<path d="M20 50 L180 50" stroke="${danger}" stroke-width="2" opacity="0.3"/><path d="M20 50 L40 30 L60 60 L80 20 L100 50 L120 50" stroke="${danger}" stroke-width="2" fill="none"/><text x="130" y="55" font-size="12" fill="${txt}">ABP Wave</text>`;
  } else {
    inner = `<text x="50%" y="50%" text-anchor="middle" fill="${txt}">Device Diagram</text>`;
  }
  return `<svg viewBox="0 0 200 100" fill="none" stroke="currentColor">${inner}</svg>`;
}

// Router & UI Control
function route(id){
  closeMenu();
  if(!id) {
    renderHome();
    location.hash = '';
  } else {
    renderDetail(id);
    location.hash = id;
  }
}

function goHome(){
  route(null);
}

function updateActiveNav(id){
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  if(id){
    const active = document.querySelector(`.nav-item[data-id="${id}"]`);
    if(active) active.classList.add('active');
  }
}

// Sidebar logic
const menuBtn = document.getElementById('menuBtn');
const closeSidebar = document.getElementById('closeSidebar');

function openMenu(){
  sidebar.classList.add('open');
  sidebarOverlay.classList.add('open');
}
function closeMenu(){
  sidebar.classList.remove('open');
  sidebarOverlay.classList.remove('open');
}

menuBtn.addEventListener('click', openMenu);
closeSidebar.addEventListener('click', closeMenu);
sidebarOverlay.addEventListener('click', closeMenu);

// Theme Toggle
const themeBtn = document.getElementById('themeBtn');
themeBtn.addEventListener('click', ()=>{
  const html = document.documentElement;
  if(html.hasAttribute('data-theme')) html.removeAttribute('data-theme');
  else html.setAttribute('data-theme', 'dark');
});

// Init
renderSidebar();
const hash = location.hash.replace('#','');
if(hash && devices.find(d=>d.id===hash)) renderDetail(hash);
else renderHome();

// History handling
window.addEventListener('popstate', ()=>{
  const h = location.hash.replace('#','');
  if(h) renderDetail(h);
  else renderHome();
});

</script>
</body>
</html>
